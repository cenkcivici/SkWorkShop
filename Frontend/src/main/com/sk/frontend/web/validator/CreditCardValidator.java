package com.sk.frontend.web.validator;import java.util.Calendar;import org.apache.commons.lang.StringUtils;import org.springframework.validation.Errors;import org.springframework.validation.Validator;import com.sk.domain.CreditCardPaymentMethod;public class CreditCardValidator implements Validator {	@Override	public boolean supports(Class<?> clazz) {		return CreditCardPaymentMethod.class.equals(clazz);	}	@Override	public void validate(Object paymentMethod, Errors errors) {		CreditCardPaymentMethod creditCardPaymentMethod = (CreditCardPaymentMethod) paymentMethod;		validateCardOwner(errors, creditCardPaymentMethod);		validateCardType(errors, creditCardPaymentMethod);		validateCardNumber(errors, creditCardPaymentMethod);		validateCardCVC(errors, creditCardPaymentMethod);		validateCardMonth(errors, creditCardPaymentMethod);		validateCardYear(errors, creditCardPaymentMethod);			}	private void validateCardYear(Errors errors, CreditCardPaymentMethod creditCardPaymentMethod) {		if (StringUtils.isBlank(creditCardPaymentMethod.getYear()))			errors.rejectValue("year", "creditCard.year.empty");		else if (!StringUtils.isNumeric(creditCardPaymentMethod.getYear())) {			errors.rejectValue("year", "creditCard.year.numeric");		} else {			Integer month = Integer.parseInt(creditCardPaymentMethod.getYear());			if (month < getCurrentYear() || month > getCurrentYear() + 12) {				errors.rejectValue("year", "creditCard.year.not.valid");			}		}	}	private int getCurrentYear() {		return Calendar.getInstance().get(Calendar.YEAR);	}	private void validateCardType(Errors errors, CreditCardPaymentMethod creditCardPaymentMethod) {		if (creditCardPaymentMethod.getCreditCardType() == null)			errors.rejectValue("creditCardType", "creditCard.creditCardType.empty");	}	private void validateCardOwner(Errors errors, CreditCardPaymentMethod creditCardPaymentMethod) {		if (StringUtils.isBlank(creditCardPaymentMethod.getOwner())){			errors.rejectValue("owner", "creditCard.owner.empty");		}else if (!StringUtils.isAlphaSpace(creditCardPaymentMethod.getOwner())) {			errors.rejectValue("owner", "creditCard.owner.alphabetic");		}	}	private void validateCardMonth(Errors errors, CreditCardPaymentMethod creditCardPaymentMethod) {		if (StringUtils.isBlank(creditCardPaymentMethod.getMonth()))			errors.rejectValue("month", "creditCard.month.empty");		else if (!StringUtils.isNumeric(creditCardPaymentMethod.getMonth())) {			errors.rejectValue("month", "creditCard.month.numeric");		} else {			Integer month = Integer.parseInt(creditCardPaymentMethod.getMonth());			if (month < 1 || month > 12) {				errors.rejectValue("month", "creditCard.month.not.valid");			}		}	}	private void validateCardCVC(Errors errors, CreditCardPaymentMethod creditCardPaymentMethod) {		if (StringUtils.isBlank(creditCardPaymentMethod.getCvc()))			errors.rejectValue("cvc", "creditCard.cvc.empty");		else {			if (!StringUtils.isNumeric(creditCardPaymentMethod.getCvc())) {				errors.rejectValue("cvc", "creditCard.cvc.numeric");			} else if (creditCardPaymentMethod.getCvc().length() != 3) {				errors.rejectValue("cvc", "creditCard.cvc.length");			}		}	}	private void validateCardNumber(Errors errors, CreditCardPaymentMethod creditCardPaymentMethod) {		if (StringUtils.isBlank(creditCardPaymentMethod.getCardNumber()))			errors.rejectValue("cardNumber", "creditCard.cardNumber.empty");		else {			if (!StringUtils.isNumeric(creditCardPaymentMethod.getCardNumber())) {				errors.rejectValue("cardNumber", "creditCard.cardNumber.numeric");			} else if (creditCardPaymentMethod.getCardNumber().length() != 16) {				errors.rejectValue("cardNumber", "creditCard.cardNumber.length");			}else{				org.apache.commons.validator.routines.CreditCardValidator validator = new org.apache.commons.validator.routines.CreditCardValidator(org.apache.commons.validator.routines.CreditCardValidator.AMEX + org.apache.commons.validator.routines.CreditCardValidator.VISA);				if( ! validator.isValid(creditCardPaymentMethod.getCardNumber())){					errors.rejectValue("cardNumber", "creditCard.cardNumber.not.valid");				}			}					}	}}